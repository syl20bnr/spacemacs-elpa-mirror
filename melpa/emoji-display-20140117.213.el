;;; emoji-display.el --- emoji displaying module -*- coding: utf-8-unix -*-

;; Copyright (C) 2011  Kazuhiro Ito

;; Author: Kazuhiro Ito <kzhr@d1.dion.ne.jp>
;; URL: https://github.com/ikazuhiro/emoji-display
;; Package-Version: 20140117.213
;; Keywords: emoji

;; This program is free software; you can redistribute it and/or modify
;; it under the terms of the GNU General Public License as published by
;; the Free Software Foundation, either version 3 of the License, or
;; (at your option) any later version.

;; This program is distributed in the hope that it will be useful,
;; but WITHOUT ANY WARRANTY; without even the implied warranty of
;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
;; GNU General Public License for more details.

;; You should have received a copy of the GNU General Public License
;; along with this program.  If not, see <http://www.gnu.org/licenses/>.

;;; Commentary:

;; Emacs 23 or later is required.
;; Get emoji images from FireMobileSimulator or EmojiPrint.
;;   FireMobileSimulator http://firemobilesimulator.org/
;;   EmojiPrint          http://www.takaaki.info/addon/emojiprint/
;;
;; 1. Place .el files to a loadable directory, and byte-compile as needed.
;; 2. Set emoji-display-image-directory variable appropriately or place
;; image directory to the same directory of .el files.
;; 3. Add your ~/.emacs as below code.
;;
;; (require 'emoji-display)
;; (emoji-display-mode)
;;
;; Known problems
;; * Resources are exhausted on MS Windows.
;; * Some animated images are corrupted.

;;; Code:

;; Customizable variables
(defgroup emoji-display nil
  "emoji image displaying features"
  :group 'convenience)

(defcustom emoji-display-image-directory
  (let (dir)
    (or (and (locate-library "emoji-display")
	     (setq dir (expand-file-name "image"
					 (file-name-directory
					  (locate-library "emoji-display"))))
	     (file-directory-p dir)
	     dir)
	(expand-file-name "emoji-display/image" data-directory)))
  "Directory for emoji image files."
  :group 'emoji-display
  :type 'directory)

(defcustom emoji-display-types
  '(docomo ezweb softbank)
  "Order of preferred emoji types."
  :group 'emoji-display
  :type '(repeat (choice (const softbank)
			 (const ezweb)
			 (const docomo))))

(defcustom emoji-display-animated-p
  (fboundp 'image-animate)
  "Non-nil means that emoji image is animated when possible."
  :group 'emoji-display
  :type 'boolean)

(defcustom emoji-display-animate-limit
  nil
  "Limit for image-animate."
  :group 'emoji-display
  :type '(choice (const t)
		 (const nil)
		 (number)))

;; Internal constants
(defvar emoji-display-type-subdir-alist
  (eval-when-compile
    (nreverse
     '(
       ;; The order must be the same as `emoji-display-table'.
       (docomo   . "i")
       (ezweb    . "e")
       (softbank . "s")
       ))))

(eval-and-compile
  (defvar emoji-display-table
    (eval-when-compile
    '(
      ("#âƒ£" "59104" "818" "17968")
      ("0âƒ£" "59115" "325" "17989")
      ("1âƒ£" "59106" "180" "17980")
      ("2âƒ£" "59107" "181" "17981")
      ("3âƒ£" "59108" "182" "17982")
      ("4âƒ£" "59109" "183" "17983")
      ("5âƒ£" "59110" "184" "17984")
      ("6âƒ£" "59111" "185" "17985")
      ("7âƒ£" "59112" "186" "17986")
      ("8âƒ£" "59113" "187" "17987")
      ("9âƒ£" "59114" "188" "17988")
      ("Â©" "59185" "81" "18030")
      ("Â®" "59190" "82" "18031")
      ("â€‚" nil "174" nil)
      ("â€ƒ" nil "173" nil)
      ("â€…" nil "175" nil)
      ("â€¼" "59140" "734" nil)
      ("â‰" "59139" "733" nil)
      ("â„¢" "59186" "54" "20823")
      ("â„¹" nil "11" nil)
      ("â†”" "59196" "808" nil)
      ("â†•" "59197" "809" nil)
      ("â†–" "59031" "42" "18007")
      ("â†—" "59000" "70" "18006")
      ("â†˜" "59030" "43" "18008")
      ("â†™" "59045" "71" "18009")
      ("â†©" "59098" "118" nil)
      ("â†ª" nil "117" nil)
      ("âŒš" "59167" "25" nil)
      ("âŒ›" nil "57" nil)
      ("â©" nil "8" "18012")
      ("âª" nil "7" "18013")
      ("â«" nil "35" nil)
      ("â¬" nil "34" nil)
      ("â°" "59066" "46" nil)
      ("â³" "59164" "58" nil)
      ("â“‚" "58972" nil nil)
      ("â–ª" nil "10" nil)
      ("â–«" nil "9" nil)
      ("â–¶" nil "6" "18010")
      ("â—€" nil "5" "18011")
      ("â—»" nil "21" nil)
      ("â—¼" nil "22" nil)
      ("â—½" nil "17" nil)
      ("â—¾" nil "18" nil)
      ("â˜€" "58942" "44" "18282")
      ("â˜" "58943" "107" "18281")
      ("â˜" "59015" "85" "18217")
      ("â˜‘" nil "507" nil)
      ("â˜”" "58944" "95" "18283")
      ("â˜•" "58992" "93" "18277")
      ("â˜" nil "284" "18223")
      ("â˜º" nil "68" "20532")
      ("â™ˆ" "58950" "192" "18015")
      ("â™‰" "58951" "193" "18016")
      ("â™Š" "58952" "194" "18017")
      ("â™‹" "58953" "195" "18018")
      ("â™Œ" "58954" "196" "18019")
      ("â™" "58955" "197" "18020")
      ("â™" "58956" "198" "18021")
      ("â™" "58957" "199" "18022")
      ("â™" "58958" "200" "18023")
      ("â™‘" "58959" "201" "18024")
      ("â™’" "58960" "202" "18025")
      ("â™“" "58961" "203" "18026")
      ("â™ " "59022" "314" "17966")
      ("â™£" "59024" "316" "17967")
      ("â™¥" "59021" "414" "17964")
      ("â™¦" "59023" "315" "17965")
      ("â™¨" "59127" "224" "17731")
      ("â™»" "59189" "807" nil)
      ("â™¿" "59035" "178" "17962")
      ("âš“" nil "211" nil)
      ("âš " "59191" "1" "18034")
      ("âš¡" "58946" "16" "17757")
      ("âšª" nil "23" nil)
      ("âš«" nil "24" nil)
      ("âš½" "58966" "219" "18232")
      ("âš¾" "58963" "45" "18230")
      ("â›„" "58945" "191" "18280")
      ("â›…" nil "167" nil)
      ("â›" nil "204" "18027")
      ("â›”" nil "98" nil)
      ("â›ª" nil "340" "18263")
      ("â›²" nil "360" "17729")
      ("â›³" "58964" "306" "18228")
      ("â›µ" "59043" "169" "18236")
      ("â›º" nil "361" "17730")
      ("â›½" "58987" "213" "18266")
      ("âœ‚" "58997" "104" "20275")
      ("âœ…" nil "132" nil)
      ("âœˆ" "58978" "168" "18237")
      ("âœ‰" "59091" "108" nil)
      ("âœŠ" "59027" "817" "18224")
      ("âœ‹" "59029" "320" "18226")
      ("âœŒ" "59028" "319" "18225")
      ("âœ" "59161" "149" nil)
      ("âœ’" "59054" "508" nil)
      ("âœ”" nil "73" nil)
      ("âœ–" nil "55" nil)
      ("âœ¨" "59130" "420" "20302")
      ("âœ³" nil "28" "17958")
      ("âœ´" nil "267" "17957")
      ("â„" nil "60" nil)
      ("â‡" nil "76" nil)
      ("âŒ" nil "61" "20307")
      ("â" nil "62" nil)
      ("â“" nil "3" "18240")
      ("â”" nil nil "20310")
      ("â•" nil nil "20311")
      ("â—" "59138" "2" "18241")
      ("â¤" "59116" "51" "18242")
      ("â•" nil "26" nil)
      ("â–" nil "27" nil)
      ("â—" nil "66" nil)
      ("â¡" nil "63" "18004")
      ("â°" "59146" "735" nil)
      ("â¤´" "59125" "731" nil)
      ("â¤µ" "59136" "732" nil)
      ("â¬…" nil "64" "18005")
      ("â¬†" nil "29" "18002")
      ("â¬‡" nil "30" "18003")
      ("â¬›" nil "39" nil)
      ("â¬œ" nil "38" nil)
      ("â­" nil "69" "20303")
      ("â­•" nil "422" "20306")
      ("ã€°" "59145" nil nil)
      ("ã€½" nil nil "17740")
      ("ãŠ—" nil "402" "20269")
      ("ãŠ™" "59188" "279" "20277")
      ("ğŸ€„" nil "362" "17741")
      ("ğŸƒ" nil "797" nil)
      ("ğŸ…°" nil "724" "20818")
      ("ğŸ…±" nil "725" "20819")
      ("ğŸ…¾" nil "726" "20821")
      ("ğŸ…¿" "58988" "208" "17775")
      ("ğŸ†" nil "727" "20820")
      ("ğŸ†‘" "59099" "324" nil)
      ("ğŸ†’" nil "382" "17972")
      ("ğŸ†“" "59095" "299" nil)
      ("ğŸ†”" "59096" "385" "17993")
      ("ğŸ†•" "59101" "334" "17970")
      ("ğŸ†–" "59183" nil nil)
      ("ğŸ†—" "59147" "326" "18029")
      ("ğŸ†˜" nil "270" nil)
      ("ğŸ†™" nil "303" "17971")
      ("ğŸ†š" nil "363" "17742")
      ("ğŸ‡¨ğŸ‡³" nil "703" "20787")
      ("ğŸ‡©ğŸ‡ª" nil "700" "20782")
      ("ğŸ‡ªğŸ‡¸" nil "366" "20785")
      ("ğŸ‡«ğŸ‡·" nil "499" "20781")
      ("ğŸ‡¬ğŸ‡§" nil "702" "20784")
      ("ğŸ‡®ğŸ‡¹" nil "701" "20783")
      ("ğŸ‡¯ğŸ‡µ" nil "237" "20779")
      ("ğŸ‡°ğŸ‡·" nil "704" "20788")
      ("ğŸ‡·ğŸ‡º" nil "367" "20786")
      ("ğŸ‡ºğŸ‡¸" nil "90" "20780")
      ("ğŸˆ" nil nil "17955")
      ("ğŸˆ‚" nil "384" "17992")
      ("ğŸˆš" nil nil "17974")
      ("ğŸˆ¯" nil "388" "17996")
      ("ğŸˆ²" "59192" nil nil)
      ("ğŸˆ³" "59193" "387" "17995")
      ("ğŸˆ´" "59194" nil nil)
      ("ğŸˆµ" "59195" "386" "17994")
      ("ğŸˆ¶" nil nil "17973")
      ("ğŸˆ·" nil nil "17975")
      ("ğŸˆ¸" nil nil "17976")
      ("ğŸˆ¹" nil "383" "17991")
      ("ğŸˆº" nil "389" "17997")
      ("ğŸ‰" nil "285" "17990")
      ("ğŸ‰‘" nil "506" nil)
      ("ğŸŒ€" "58947" "190" "20579")
      ("ğŸŒ" "58948" "305" nil)
      ("ğŸŒ‚" "58949" "481" "20572")
      ("ğŸŒƒ" "59059" "490" "20587")
      ("ğŸŒ„" nil nil "18285")
      ("ğŸŒ…" nil "493" "20585")
      ("ğŸŒ†" nil "371" "17766")
      ("ğŸŒ‡" nil nil "20586")
      ("ğŸŒˆ" nil "491" "20588")
      ("ğŸŒ‰" nil "227" nil)
      ("ğŸŒŠ" "59199" "810" "20574")
      ("ğŸŒ‹" nil "769" nil)
      ("ğŸŒŒ" nil "781" nil)
      ("ğŸŒ" nil "332" nil)
      ("ğŸŒ‘" "59036" "321" nil)
      ("ğŸŒ“" "59038" "323" nil)
      ("ğŸŒ”" "59037" "322" nil)
      ("ğŸŒ•" "59040" nil nil)
      ("ğŸŒ™" "59039" "15" "18284")
      ("ğŸŒ›" nil "47" nil)
      ("ğŸŒŸ" nil nil "20309")
      ("ğŸŒ " nil "75" nil)
      ("ğŸŒ°" nil "742" nil)
      ("ğŸŒ±" "59206" "811" nil)
      ("ğŸŒ´" nil "255" "20263")
      ("ğŸŒµ" nil "399" "20264")
      ("ğŸŒ·" "59203" "113" "20260")
      ("ğŸŒ¸" "59208" "235" "18256")
      ("ğŸŒ¹" nil "339" "18258")
      ("ğŸŒº" nil "397" "20259")
      ("ğŸŒ»" nil "256" "20261")
      ("ğŸŒ¼" nil "759" nil)
      ("ğŸŒ½" nil "740" nil)
      ("ğŸŒ¾" nil nil "20580")
      ("ğŸŒ¿" nil "816" nil)
      ("ğŸ€" "59201" "53" "17712")
      ("ğŸ" "59207" "133" "17720")
      ("ğŸ‚" nil "358" "17721")
      ("ğŸƒ" nil nil "20583")
      ("ğŸ„" nil "741" nil)
      ("ğŸ…" nil "436" "20329")
      ("ğŸ†" nil "437" "20330")
      ("ğŸ‡" nil "738" nil)
      ("ğŸˆ" nil "736" nil)
      ("ğŸ‰" nil "238" "20328")
      ("ğŸŠ" nil "435" "20326")
      ("ğŸŒ" "59204" "739" nil)
      ("ğŸ" nil "737" nil)
      ("ğŸ" "59205" "434" "20325")
      ("ğŸ" nil "776" nil)
      ("ğŸ‘" nil "743" nil)
      ("ğŸ’" "59202" "241" nil)
      ("ğŸ“" nil "243" "20327")
      ("ğŸ”" "58995" "245" "17728")
      ("ğŸ•" nil "745" nil)
      ("ğŸ–" nil "160" nil)
      ("ğŸ—" nil "746" nil)
      ("ğŸ˜" nil "428" "20317")
      ("ğŸ™" "59209" "244" "20322")
      ("ğŸš" nil "429" "20318")
      ("ğŸ›" nil "431" "20321")
      ("ğŸœ" "59212" "333" "20320")
      ("ğŸ" nil "430" "20319")
      ("ğŸ" "59213" "424" "20313")
      ("ğŸŸ" nil "426" "20315")
      ("ğŸ " nil "744" nil)
      ("ğŸ¡" nil "427" "20316")
      ("ğŸ¢" nil "432" "20323")
      ("ğŸ£" nil "433" "20324")
      ("ğŸ¤" nil "798" nil)
      ("ğŸ¥" nil "275" nil)
      ("ğŸ¦" nil "425" "20314")
      ("ğŸ§" nil "483" "20575")
      ("ğŸ¨" nil "760" nil)
      ("ğŸ©" nil "761" nil)
      ("ğŸª" nil "762" nil)
      ("ğŸ«" nil "763" nil)
      ("ğŸ¬" nil "764" nil)
      ("ğŸ­" nil "765" nil)
      ("ğŸ®" nil "772" nil)
      ("ğŸ¯" nil "775" nil)
      ("ğŸ°" "59210" "239" "18278")
      ("ğŸ±" nil "438" "20332")
      ("ğŸ²" nil "439" "20333")
      ("ğŸ³" nil "240" "17767")
      ("ğŸ´" "58991" "146" "18275")
      ("ğŸµ" "59166" "423" "20312")
      ("ğŸ¶" "59211" "400" "20267")
      ("ğŸ·" "59222" "12" nil)
      ("ğŸ¸" "58993" "52" "18276")
      ("ğŸ¹" nil "748" nil)
      ("ğŸº" "58994" "65" "18279")
      ("ğŸ»" nil "401" "20268")
      ("ğŸ€" "59012" "312" "20276")
      ("ğŸ" "59013" "144" "17714")
      ("ğŸ‚" "59014" "313" "20331")
      ("ğŸƒ" nil "487" "20581")
      ("ğŸ„" "59044" "234" "18259")
      ("ğŸ…" nil "489" "20584")
      ("ğŸ†" nil "357" "17719")
      ("ğŸ‡" nil "484" "20576")
      ("ğŸˆ" nil "404" "20272")
      ("ğŸ‰" nil "405" "20274")
      ("ğŸŠ" nil "230" nil)
      ("ğŸ‹" nil "747" nil)
      ("ğŸŒ" nil "370" "17763")
      ("ğŸ" nil "476" "20566")
      ("ğŸ" nil "477" "20568")
      ("ğŸ" nil "480" "20571")
      ("ğŸ" nil "486" "20578")
      ("ğŸ‘" nil "488" "20582")
      ("ğŸ’" nil "479" "20570")
      ("ğŸ“" nil "478" "20569")
      ("ğŸ " "59001" nil nil)
      ("ğŸ¡" nil "223" "17732")
      ("ğŸ¢" nil "475" "20563")
      ("ğŸ£" nil "752" nil)
      ("ğŸ¤" "58998" "289" "18268")
      ("ğŸ¥" "58999" "110" "18269")
      ("ğŸ¦" nil nil "20775")
      ("ğŸ§" "59002" "294" "20266")
      ("ğŸ¨" "59003" "309" "20770")
      ("ğŸ©" "59004" "494" "20771")
      ("ğŸª" "59005" "311" nil)
      ("ğŸ«" "59006" "106" "17733")
      ("ğŸ¬" "59052" "226" "20292")
      ("ğŸ­" nil "310" nil)
      ("ğŸ®" "59019" "232" nil)
      ("ğŸ¯" nil "231" "17744")
      ("ğŸ°" nil "229" "17747")
      ("ğŸ±" nil "470" "20556")
      ("ğŸ²" nil "170" nil)
      ("ğŸ³" nil "753" nil)
      ("ğŸ´" nil "796" nil)
      ("ğŸµ" "59126" "343" "18270")
      ("ğŸ¶" "59135" "291" "20294")
      ("ğŸ·" nil nil "18272")
      ("ğŸ¸" nil "292" "18273")
      ("ğŸ¹" nil "750" nil)
      ("ğŸº" nil "469" "18274")
      ("ğŸ»" nil "293" nil)
      ("ğŸ¼" nil "453" nil)
      ("ğŸ½" "58962" nil nil)
      ("ğŸ¾" "58965" "220" "18229")
      ("ğŸ¿" "58967" "421" "18227")
      ("ğŸ€" "58968" "307" "20554")
      ("ğŸ" "58969" "222" "17746")
      ("ğŸ‚" "59154" "221" nil)
      ("ğŸƒ" "59187" "218" "17717")
      ("ğŸ„" nil "751" "18231")
      ("ğŸ†" nil "364" "17745")
      ("ğŸˆ" nil "96" "20555")
      ("ğŸŠ" nil "471" "20557")
      ("ğŸ " "58979" "112" "18262")
      ("ğŸ¡" nil "514" nil)
      ("ğŸ¢" "58980" "156" "18264")
      ("ğŸ£" "58981" "375" "17779")
      ("ğŸ¥" "58982" "376" "17781")
      ("ğŸ¦" "58983" "212" "17773")
      ("ğŸ§" "58984" "205" "17780")
      ("ğŸ¨" "58985" "378" "17784")
      ("ğŸ©" nil "492" "20769")
      ("ğŸª" "58986" "206" "17782")
      ("ğŸ«" "59198" "377" "17783")
      ("ğŸ¬" nil "495" "20772")
      ("ğŸ­" nil "498" "20776")
      ("ğŸ®" nil "225" nil)
      ("ğŸ¯" nil "496" "20773")
      ("ğŸ°" nil "497" "20774")
      ("ğŸŒ" "59214" "812" nil)
      ("ğŸ" nil "720" "20813")
      ("ğŸ" nil nil "17748")
      ("ğŸ‘" nil nil "20809")
      ("ğŸ’" nil nil "20808")
      ("ğŸ”" nil "721" "20814")
      ("ğŸ—" nil "722" "20815")
      ("ğŸ˜" nil "717" "20806")
      ("ğŸ™" nil "352" "17706")
      ("ğŸš" nil "485" "20577")
      ("ğŸ›" nil "716" "20805")
      ("ğŸœ" nil "253" nil)
      ("ğŸ" nil "773" nil)
      ("ğŸ" nil "774" nil)
      ("ğŸŸ" "59217" nil "18233")
      ("ğŸ " nil "715" "20802")
      ("ğŸ¡" nil "242" nil)
      ("ğŸ¢" nil "365" nil)
      ("ğŸ£" nil "372" nil)
      ("ğŸ¤" "59215" "78" "20803")
      ("ğŸ¥" nil "804" nil)
      ("ğŸ¦" nil nil "20801")
      ("ğŸ§" "59216" "252" "18293")
      ("ğŸ¨" nil "718" "20807")
      ("ğŸ©" nil "74" nil)
      ("ğŸ«" nil "723" "20816")
      ("ğŸ¬" nil "713" "20800")
      ("ğŸ­" nil "347" "18291")
      ("ğŸ®" nil "719" "20811")
      ("ğŸ¯" nil "345" "18288")
      ("ğŸ°" nil "247" "20812")
      ("ğŸ±" "59042" "251" "18287")
      ("ğŸ²" nil "749" nil)
      ("ğŸ³" nil "246" "18292")
      ("ğŸ´" "59220" "248" "18234")
      ("ğŸµ" nil "249" "17705")
      ("ğŸ¶" "59041" "134" "18290")
      ("ğŸ·" "59221" "254" "17707")
      ("ğŸ¸" nil "250" "20817")
      ("ğŸ¹" nil nil "20804")
      ("ğŸº" nil nil "20810")
      ("ğŸ»" nil "346" "18289")
      ("ğŸ¼" nil "756" nil)
      ("ğŸ½" nil "758" nil)
      ("ğŸ¾" nil "276" nil)
      ("ğŸ‘€" "59025" "317" "20537")
      ("ğŸ‘‚" "59026" "318" "20539")
      ("ğŸ‘ƒ" nil "457" "20538")
      ("ğŸ‘„" nil "458" "20540")
      ("ğŸ‘…" nil "757" nil)
      ("ğŸ‘†" nil "390" "17998")
      ("ğŸ‘‡" nil "391" "17999")
      ("ğŸ‘ˆ" nil "140" "18000")
      ("ğŸ‘‰" nil "141" "18001")
      ("ğŸ‘Š" "59133" "281" "18221")
      ("ğŸ‘‹" nil "463" "20542")
      ("ğŸ‘Œ" nil "461" "20544")
      ("ğŸ‘" "59175" "287" "18222")
      ("ğŸ‘" nil "462" "20545")
      ("ğŸ‘" nil "460" "20543")
      ("ğŸ‘" nil nil "20546")
      ("ğŸ‘‘" "59162" "354" "17710")
      ("ğŸ‘’" nil "407" "20280")
      ("ğŸ‘“" "59034" "116" nil)
      ("ğŸ‘”" nil "396" "20258")
      ("ğŸ‘•" "59150" "335" "18214")
      ("ğŸ‘–" "59153" "805" nil)
      ("ğŸ‘—" nil "793" "20281")
      ("ğŸ‘˜" nil "412" "20289")
      ("ğŸ‘™" nil "413" "20290")
      ("ğŸ‘š" nil "301" nil)
      ("ğŸ‘›" "59151" "290" nil)
      ("ğŸ‘œ" "59010" "83" "20291")
      ("ğŸ‘" "59053" nil nil)
      ("ğŸ‘" nil "336" nil)
      ("ğŸ‘Ÿ" "59033" "729" "18215")
      ("ğŸ‘ " "58996" "124" "17758")
      ("ğŸ‘¡" nil nil "20282")
      ("ğŸ‘¢" nil "408" "20283")
      ("ğŸ‘£" "59032" "728" "20822")
      ("ğŸ‘¤" "59057" nil nil)
      ("ğŸ‘¦" nil nil "18209")
      ("ğŸ‘§" nil nil "18210")
      ("ğŸ‘¨" nil "80" "18212")
      ("ğŸ‘©" nil "50" "18213")
      ("ğŸ‘ª" nil "163" nil)
      ("ğŸ‘«" nil nil "20552")
      ("ğŸ‘®" nil "374" "17778")
      ("ğŸ‘¯" nil "468" "20553")
      ("ğŸ‘°" nil "482" nil)
      ("ğŸ‘±" nil "705" "20789")
      ("ğŸ‘²" nil "706" "20790")
      ("ğŸ‘³" nil "707" "20791")
      ("ğŸ‘´" nil "708" "20792")
      ("ğŸ‘µ" nil "709" "20793")
      ("ğŸ‘¶" nil "710" "20794")
      ("ğŸ‘·" nil "711" "20795")
      ("ğŸ‘¸" nil "712" "20796")
      ("ğŸ‘¹" nil "754" nil)
      ("ğŸ‘º" nil "755" nil)
      ("ğŸ‘»" nil "236" "17723")
      ("ğŸ‘¼" nil "344" "18286")
      ("ğŸ‘½" nil "302" "17708")
      ("ğŸ‘¾" nil "274" "17739")
      ("ğŸ‘¿" nil "277" "17722")
      ("ğŸ’€" nil "286" "17724")
      ("ğŸ’" nil nil "18035")
      ("ğŸ’‚" nil nil "20798")
      ("ğŸ’ƒ" nil "714" "20799")
      ("ğŸ’„" "59152" "295" "20284")
      ("ğŸ’…" nil "409" "20285")
      ("ğŸ’†" nil "297" "20286")
      ("ğŸ’‡" nil "410" "20287")
      ("ğŸ’ˆ" nil "411" "20288")
      ("ğŸ’‰" nil "304" "17755")
      ("ğŸ’Š" nil "403" "20271")
      ("ğŸ’‹" "59129" "273" "18211")
      ("ğŸ’Œ" "59159" "806" nil)
      ("ğŸ’" "59163" "72" "18260")
      ("ğŸ’" nil nil "18261")
      ("ğŸ’" nil "355" "17713")
      ("ğŸ’" nil "398" "20262")
      ("ğŸ’‘" nil "467" "20549")
      ("ğŸ’’" nil nil "20573")
      ("ğŸ’“" "59117" "803" "20295")
      ("ğŸ’”" "59118" "265" "18243")
      ("ğŸ’•" "59119" "266" nil)
      ("ğŸ’–" nil "415" nil)
      ("ğŸ’—" nil nil "20296")
      ("ğŸ’˜" nil "272" "20297")
      ("ğŸ’™" nil "416" "20298")
      ("ğŸ’š" nil "417" "20299")
      ("ğŸ’›" nil "418" "20300")
      ("ğŸ’œ" nil "419" "20301")
      ("ğŸ’" nil "770" "20567")
      ("ğŸ’" nil "328" nil)
      ("ğŸ’Ÿ" nil nil "17956")
      ("ğŸ’ " "59128" nil nil)
      ("ğŸ’¡" "59131" "77" "17711")
      ("ğŸ’¢" "59132" "262" "20308")
      ("ğŸ’£" "59134" "268" "20273")
      ("ğŸ’¤" "59137" "261" "17756")
      ("ğŸ’¥" "59141" "329" nil)
      ("ğŸ’¦" "59142" "330" "20305")
      ("ğŸ’§" "59143" "263" nil)
      ("ğŸ’¨" "59144" "282" "20304")
      ("ğŸ’©" nil "283" "18298")
      ("ğŸ’ª" nil "271" "17772")
      ("ğŸ’«" nil "778" nil)
      ("ğŸ’¬" nil "86" nil)
      ("ğŸ’®" nil "278" nil)
      ("ğŸ’¯" nil "280" nil)
      ("ğŸ’°" "59157" "233" "17743")
      ("ğŸ’±" nil nil "17769")
      ("ğŸ’²" nil "14" nil)
      ("ğŸ’³" nil "87" nil)
      ("ğŸ’´" "59094" "109" nil)
      ("ğŸ’µ" nil "139" nil)
      ("ğŸ’¸" nil "777" nil)
      ("ğŸ’¹" nil "373" "17770")
      ("ğŸ’º" "59058" nil "17727")
      ("ğŸ’»" "59158" "337" "18220")
      ("ğŸ’¼" nil "359" "17726")
      ("ğŸ’½" nil "126" "20278")
      ("ğŸ’¾" nil "59" nil)
      ("ğŸ’¿" "59020" "300" "17734")
      ("ğŸ“€" nil nil "17735")
      ("ğŸ“" nil "79" nil)
      ("ğŸ“‚" nil "84" nil)
      ("ğŸ“ƒ" nil "56" nil)
      ("ğŸ“„" nil "103" nil)
      ("ğŸ“…" nil "67" nil)
      ("ğŸ“†" nil "105" nil)
      ("ğŸ“‡" nil "131" nil)
      ("ğŸ“ˆ" nil "128" nil)
      ("ğŸ“‰" nil "159" nil)
      ("ğŸ“Š" nil "127" nil)
      ("ğŸ“‹" nil "92" nil)
      ("ğŸ“Œ" nil "137" nil)
      ("ğŸ“" nil "49" nil)
      ("ğŸ“" "59184" "143" nil)
      ("ğŸ“" nil "157" nil)
      ("ğŸ“" nil "158" nil)
      ("ğŸ“‘" nil "516" nil)
      ("ğŸ“’" nil "142" nil)
      ("ğŸ““" nil "121" nil)
      ("ğŸ“”" nil "91" nil)
      ("ğŸ“•" nil "102" nil)
      ("ğŸ“–" "59011" "122" "17768")
      ("ğŸ“—" nil "97" nil)
      ("ğŸ“˜" nil "100" nil)
      ("ğŸ“™" nil "101" nil)
      ("ğŸ“š" nil "147" nil)
      ("ğŸ“›" nil "145" nil)
      ("ğŸ“œ" nil "136" nil)
      ("ğŸ“" "59017" "395" "20257")
      ("ğŸ“" nil "155" nil)
      ("ğŸ“Ÿ" "58970" "308" nil)
      ("ğŸ“ " "59088" "166" "18219")
      ("ğŸ“¡" nil "210" "17771")
      ("ğŸ“¢" nil nil "17762")
      ("ğŸ“£" nil nil "20279")
      ("ğŸ“¤" nil "153" nil)
      ("ğŸ“¥" nil "154" nil)
      ("ğŸ“¦" nil "165" nil)
      ("ğŸ“§" nil "799" nil)
      ("ğŸ“¨" nil "151" nil)
      ("ğŸ“©" "59087" "784" "17699")
      ("ğŸ“ª" nil "129" nil)
      ("ğŸ“«" nil "515" "17697")
      ("ğŸ“®" nil nil "17698")
      ("ğŸ“°" nil "171" nil)
      ("ğŸ“±" "59016" "161" "18218")
      ("ğŸ“²" "59086" "513" "17700")
      ("ğŸ“³" nil "393" "18032")
      ("ğŸ“´" nil "394" "18033")
      ("ğŸ“¶" nil "381" "17963")
      ("ğŸ“·" "59009" "94" "18216")
      ("ğŸ“¹" nil "111" nil)
      ("ğŸ“º" "59018" "288" "17738")
      ("ğŸ“»" nil "338" "17736")
      ("ğŸ“¼" nil "115" "17737")
      ("ğŸ”ƒ" nil "518" nil)
      ("ğŸ”Š" nil "13" "17761")
      ("ğŸ”‹" nil "135" nil)
      ("ğŸ”Œ" nil "162" nil)
      ("ğŸ”" "59100" "119" "17716")
      ("ğŸ”" nil "510" nil)
      ("ğŸ”" nil "517" nil)
      ("ğŸ”" nil "501" nil)
      ("ğŸ”‘" "59097" "120" "18271")
      ("ğŸ”’" nil "138" "17764")
      ("ğŸ”“" nil nil "17765")
      ("ğŸ””" "59155" "48" "20293")
      ("ğŸ”–" nil "512" nil)
      ("ğŸ”—" nil "164" nil)
      ("ğŸ”˜" nil "509" nil)
      ("ğŸ”™" nil "511" nil)
      ("ğŸ”š" "59065" nil nil)
      ("ğŸ”›" "59064" nil nil)
      ("ğŸ”œ" "59063" nil nil)
      ("ğŸ”" nil nil "18028")
      ("ğŸ”" nil "380" "17959")
      ("ğŸ”Ÿ" nil "189" nil)
      ("ğŸ” " nil "502" nil)
      ("ğŸ”¡" nil "503" nil)
      ("ğŸ”¢" nil "504" nil)
      ("ğŸ”£" nil "505" nil)
      ("ğŸ”¤" nil "771" nil)
      ("ğŸ”¥" nil "269" "17725")
      ("ğŸ”¦" nil "130" nil)
      ("ğŸ”§" "59160" "152" nil)
      ("ğŸ”¨" nil "356" "17718")
      ("ğŸ”©" nil "123" nil)
      ("ğŸ”ª" nil "114" nil)
      ("ğŸ”«" nil "296" "17715")
      ("ğŸ”®" nil "392" nil)
      ("ğŸ”¯" nil nil "18014")
      ("ğŸ”°" nil "179" "17961")
      ("ğŸ”±" nil nil "18257")
      ("ğŸ”²" nil nil "17978")
      ("ğŸ”³" nil nil "17979")
      ("ğŸ”´" nil "40" "17977")
      ("ğŸ”µ" nil "41" nil)
      ("ğŸ”¶" nil "36" nil)
      ("ğŸ”·" nil "37" nil)
      ("ğŸ”¸" nil "19" nil)
      ("ğŸ”¹" nil "20" nil)
      ("ğŸ”º" nil "88" nil)
      ("ğŸ”»" nil "89" nil)
      ("ğŸ”¼" nil "33" nil)
      ("ğŸ”½" nil "32" nil)
      ("ğŸ•" nil nil "18244")
      ("ğŸ•‘" nil nil "18245")
      ("ğŸ•’" nil nil "18246")
      ("ğŸ•“" nil nil "18247")
      ("ğŸ•”" nil nil "18248")
      ("ğŸ••" nil nil "18249")
      ("ğŸ•–" nil nil "18250")
      ("ğŸ•—" nil nil "18251")
      ("ğŸ•˜" nil nil "18252")
      ("ğŸ•™" nil nil "18253")
      ("ğŸ•š" nil nil "18254")
      ("ğŸ•›" nil nil "18255")
      ("ğŸ—»" "59200" "342" "18267")
      ("ğŸ—¼" nil "228" "20777")
      ("ğŸ—½" nil nil "20797")
      ("ğŸ—¾" nil "214" nil)
      ("ğŸ—¿" nil "794" nil)
      ("ğŸ˜" "59219" "814" "20516")
      ("ğŸ˜‚" nil "786" "20530")
      ("ğŸ˜ƒ" "59120" "257" "18295")
      ("ğŸ˜„" nil nil "20533")
      ("ğŸ˜…" "59170" nil nil)
      ("ğŸ˜†" "59178" nil nil)
      ("ğŸ˜‰" "59177" "348" "20517")
      ("ğŸ˜Š" nil "454" "18294")
      ("ğŸ˜‹" "59218" nil nil)
      ("ğŸ˜Œ" "59169" "446" "20522")
      ("ğŸ˜" "59174" "349" "17702")
      ("ğŸ˜" "59180" "440" "20514")
      ("ğŸ˜’" "59173" "450" "20526")
      ("ğŸ˜“" "59171" "351" "17704")
      ("ğŸ˜”" "59168" "441" "20515")
      ("ğŸ˜–" "59123" "444" "20519")
      ("ğŸ˜˜" nil "456" "20536")
      ("ğŸ˜š" nil "455" "20535")
      ("ğŸ˜œ" "59176" "264" "17701")
      ("ğŸ˜" nil nil "20521")
      ("ğŸ˜" "59122" nil "18296")
      ("ğŸ˜ " "59121" "258" "18297")
      ("ğŸ˜¡" "59172" "779" "20534")
      ("ğŸ˜¢" "59182" "791" "20531")
      ("ğŸ˜£" "59179" "443" "20518")
      ("ğŸ˜¤" nil "442" nil)
      ("ğŸ˜¥" nil nil "20513")
      ("ğŸ˜¨" nil "447" "20523")
      ("ğŸ˜©" nil "789" nil)
      ("ğŸ˜ª" nil "445" "20520")
      ("ğŸ˜«" nil "260" nil)
      ("ğŸ˜­" "59181" "259" "20529")
      ("ğŸ˜°" nil "452" "20527")
      ("ğŸ˜±" "59223" "350" "17703")
      ("ğŸ˜²" nil "451" "20528")
      ("ğŸ˜³" nil "449" "20525")
      ("ğŸ˜µ" "59124" "327" nil)
      ("ğŸ˜·" nil "448" "20524")
      ("ğŸ˜¸" nil "813" nil)
      ("ğŸ˜¹" nil "785" nil)
      ("ğŸ˜º" nil "783" nil)
      ("ğŸ˜»" nil "787" nil)
      ("ğŸ˜¼" nil "792" nil)
      ("ğŸ˜½" nil "782" nil)
      ("ğŸ˜¾" nil "780" nil)
      ("ğŸ˜¿" nil "790" nil)
      ("ğŸ™€" nil "788" nil)
      ("ğŸ™…" nil "464" "20547")
      ("ğŸ™†" nil "465" "20548")
      ("ğŸ™‡" nil "466" "20550")
      ("ğŸ™ˆ" nil "766" nil)
      ("ğŸ™‰" nil "768" nil)
      ("ğŸ™Š" nil "767" nil)
      ("ğŸ™‹" nil "819" nil)
      ("ğŸ™Œ" nil "820" "20551")
      ("ğŸ™" nil "821" nil)
      ("ğŸ™" nil "822" nil)
      ("ğŸ™" nil "459" "20541")
      ("ğŸš€" nil "353" "17709")
      ("ğŸšƒ" "58971" "172" "18238")
      ("ğŸš„" "58973" nil "20565")
      ("ğŸš…" nil "217" "18239")
      ("ğŸš‡" nil "341" "20564")
      ("ğŸš‰" nil "795" "18265")
      ("ğŸšŒ" "58976" "216" "17785")
      ("ğŸš" nil "209" "17776")
      ("ğŸš‘" nil "473" "20561")
      ("ğŸš’" nil "472" "20560")
      ("ğŸš“" nil "474" "20562")
      ("ğŸš•" nil nil "17786")
      ("ğŸš—" "58974" "125" "18235")
      ("ğŸš™" "58975" nil "20558")
      ("ğŸšš" nil "148" "20559")
      ("ğŸš¢" "58977" "379" "17954")
      ("ğŸš¤" nil nil "17749")
      ("ğŸš¥" "58989" "99" "17774")
      ("ğŸš§" nil "368" "17751")
      ("ğŸš¨" nil "801" nil)
      ("ğŸš©" "59102" "730" nil)
      ("ğŸšª" "59156" nil nil)
      ("ğŸš«" nil "31" nil)
      ("ğŸš¬" "59007" "176" "20270")
      ("ğŸš­" "59008" "177" "17960")
      ("ğŸš²" "59165" "215" "17750")
      ("ğŸš¶" nil "800" "17953")
      ("ğŸš¹" nil nil "17752")
      ("ğŸšº" nil nil "17753")
      ("ğŸš»" "58990" "207" "17777")
      ("ğŸš¼" nil nil "17754")
      ("ğŸš½" nil nil "17760")
      ("ğŸš¾" nil nil "20265")
      ("ğŸ›€" nil "369" "17759")
      ))))

(defvar emoji-display-emoji-regexp
  (eval-when-compile
    (regexp-opt (mapcar 'car emoji-display-table))))


;; Internal variables
(defvar emoji-display-create-image-function
  (if (fboundp 'create-animated-image) 'create-animated-image
    'create-image))

(defvar emoji-display-cache nil)

(defvar emoji-display-internal nil)


;; Internal functions.
(defsubst emoji-display-type-directory (type)
  (expand-file-name (cdr (assq type emoji-display-type-subdir-alist))
		    emoji-display-image-directory))

(defun emoji-display-display (start end length)
  "Hook function for `after-change-functions' to display emoji image."
  (unless emoji-display-internal
    (let ((emoji-display-internal t))
      (save-match-data
	(emoji-display-display-region start end)))))

(defun emoji-display-display-buffer ()
  "Hook function for `find-file-hook' to display emoji image."
  (unless emoji-display-internal
    (let ((emoji-display-internal t))
      (save-match-data
	(emoji-display-display-region (point-min) (point-max))))))

(defun emoji-display-display-region (start end)
  "Add emoji display properties to region."
  (save-excursion
    (goto-char start)
    (let ((inhibit-read-only t)
	  (modified (buffer-modified-p)))
      (while (re-search-forward emoji-display-emoji-regexp end t)
	(let ((image (emoji-display-get-image (match-string 0))))
	  (when image
	    (add-text-properties (match-beginning 0) (match-end 0)
				 `(display ,image emoji-display t))
	    (when (and emoji-display-animated-p
		       (fboundp 'image-animate))
	      (image-animate image nil emoji-display-animate-limit)))))
      (set-buffer-modified-p modified))))

(defun emoji-display-undisplay-region (start end)
  "Remove emoji display properties to region."
  (save-excursion
    (goto-char start)
    (let ((point start)
	  (inhibit-read-only t)
	  (modified (buffer-modified-p)))
      (while (null (eq point end))
	(goto-char (next-single-property-change point 'emoji-display nil end))
	(when (get-text-property point 'emoji-display)
	  (remove-list-of-text-properties point (point)
					  '(emoji-display display)))
	(setq point (point)))
      (set-buffer-modified-p modified))))

(defun emoji-display-get-image (string)
  (set-text-properties 0 (length string) nil string)
  (if (assoc string emoji-display-cache)
      (copy-sequence (cdr (assoc string emoji-display-cache)))
    (let ((list (assoc string emoji-display-table))
	  (types emoji-display-types)
	  name file image data)
      (while (and types (null image))
	(if (and (setq name
		       (nth (length
			     (memq (assq (car types)
					 emoji-display-type-subdir-alist)
				   emoji-display-type-subdir-alist))
			    list))
		 (file-readable-p
		  (setq file (expand-file-name
			      (format "%s.gif" name)
			      (emoji-display-type-directory (car types))))))
	    (progn
	      ;; (with-temp-buffer
	      ;; 	(set-buffer-multibyte nil)
	      ;; 	(insert-file-contents-literally file)
	      ;; 	(setq data (buffer-string)))
	      ;; (setq image (funcall emoji-display-create-image-function
	      ;; 			   data 'gif t :ascent 'center))
	      (setq image (funcall emoji-display-create-image-function
	       			   file 'gif nil :ascent 'center))
	      (setq emoji-display-cache
		    (cons (cons string image)
			  emoji-display-cache)))
	  (setq types (cdr types))))
      image)))


;; UI functions
;;;###autoload
(define-minor-mode emoji-display-mode
  "Toggle emoji displaying mode."
  :global t
  :group 'emoji-display
  :init-value nil
  (cond
   (emoji-display-mode
    (save-match-data
      (mapc (lambda (buffer)
	      (with-current-buffer buffer
		(save-restriction
		  (widen)
		  (emoji-display-display-region (point-min) (point-max)))))
	    (buffer-list))
      (add-hook 'after-change-functions 'emoji-display-display)
      (add-hook 'find-file-hook 'emoji-display-display-buffer)))
   (t
    (remove-hook 'after-change-functions 'emoji-display-display)
    (remove-hook 'find-file-hook 'emoji-display-display-buffer)
    (save-match-data
      (mapc (lambda (buffer)
	      (with-current-buffer buffer
		(save-restriction
		  (widen)
		  (emoji-display-undisplay-region (point-min) (point-max)))))
	    (buffer-list))))))

(defun emoji-display-cache-clear ()
  "Clear emoji-display image cache."
  (interactive)
  (setq emoji-display-cache nil))

(provide 'emoji-display)
;;; emoji-display.el ends here
